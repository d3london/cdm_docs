
## PERSON

### OMOP CDM 5.4
This table serves as the central identity management for all Persons in the database. It contains records that uniquely identify each person or patient, and some demographic information.
```{mermaid}
erDiagram
    PERSON {
        person_id integer "[PK not null] autogenerated identifier"
        gender_concept_id integer "[not null]"
        year_of_birth integer "[not null]"
        month_of_birth integer
        day_of_birth integer
        birth_datetime timestamp
        race_concept_id integer "[not null] race or ethnicity"
        ethnicity_concept_id integer "[not null] US-specific hispanic vs non-hispanic"
        location_id integer "patient physical address"
        provider_id integer "GP who is primary care provider"
        care_site_id integer "GP surgery for primary care"
        person_source_value varchar50 "person identifer source value"
        gender_source_value varchar50 "biological sex as represented in source"
        gender_source_concept_id integer "mapping to omop, but often empty"
        race_source_value varchar50 "race or ethnicity as represented in source"
        race_source_concept_id integer "mapping to omop, but often empty"
        ethnicity_source_value varchar50 "US-specific as represented in source"
        ethnicity_source_concept_id integer "mapping to omop, but often empty"
    }
```

### IMPLEMENTATION CDM 5.4

The CDM 5.4 PERSON table is staged through a more comprehensive PERSON_WIDE table. 

The PERSON_WIDE table has the following differences:

- Surfaces person_nhs_number and person_mrn
- Mapped concept codes/names are surfaced (and indexed) to enable user-friendly exploration and visualisation, and to avoid large joins
- Source concept codes/names are surfaced to enable user-friendly visibility over semantic provenance
- OMOP columns that are not relevant to NHS or to intended purposes are initialised, but set as null

```{mermaid}
erDiagram
    PERSON_WIDE {
        person_id integer "[PK]"
        person_nhs_number integer "[NEW]"
        person_mrn varchar50 "[NEW]"
        gender_concept_id integer "[not null]"
        gender_concept_code varchar50 "[NEW] standard concept code"
        gender_concept_name varchar50 "[NEW] standard concept name"
        year_of_birth integer "[not null]"
        month_of_birth integer
        day_of_birth integer
        birth_datetime timestamp "[set as null]"
        race_concept_id integer "[not null] race or ethnicity"
        race_concept_code varchar50 "[NEW] standard concept code"
        race_concept_name varchar50 "[NEW] standard concept name"        
        ethnicity_concept_id integer "[set as null]"
        location_id integer "[set as null]"
        provider_id integer "[set as null]"
        care_site_id integer "[set as null]"
        person_source_value varchar50 "contains mrn"
        gender_source_value varchar50 "biological sex source code"
        gender_source_value_name varchar50 "[NEW] biological sex source name"
        gender_source_concept_id integer "[set as null]"
        race_source_value varchar50 "ethnicity code as in source"
        race_source_value_name varchar50 "[NEW] ethnicity name as in source"
        race_source_concept_id integer "[set as null]"
        ethnicity_source_value varchar50 "[set as null]"
        ethnicity_source_concept_id integer "[set as null]"    
    }

PERSON_WIDE ||--|| PERSON: view

    PERSON {
        person_id integer "[PK not null] autogenerated identifier"
        gender_concept_id integer "[not null]"
        year_of_birth integer "[not null]"
        month_of_birth integer
        day_of_birth integer
        birth_datetime timestamp "[set_as_null]"
        race_concept_id integer "[not null] race or ethnicity"
        ethnicity_concept_id integer "[set_as_null]"
        location_id integer "[set_as_null]"
        provider_id integer "[set_as_null]"
        care_site_id integer "[set_as_null]"
        person_source_value varchar50 "contains mrn"
        gender_source_value varchar50 "biological sex source code"
        gender_source_concept_id integer "[set_as_null]"
        race_source_value varchar50 "ethnicity code as in source"
        race_source_concept_id integer "[set_as_null]"
        ethnicity_source_value varchar50 "[set_as_null]"
        ethnicity_source_concept_id integer "[set_as_null]"
    }
```


### ADDITIONAL NOTES

#### Person ID generation
While hospitals make effort to keep MRN numbers unique, it is possible that a single patient may have multiple MRNs. An option is to use NHS numbers, but these are not always available or compulsory in the record (e.g. patients from overseas may not have NHS numbers). As such person_id is based on MRN (see Person disambiguation)

#### Table and systems provenance
Fields may also be derived from different source tables. We do not record row or systems lineage within PERSON tables.

### OUTSTANDING ISSUES

#### Changes in person characteristics
Rows in PERSON / PERSON_WIDE for a given person_id are not necessarily immutable, as demographic information may appear differently over different records (e.g. corrections, changes). When a demographic value is updated in a person's record, and this is loaded into the table, differences compared to historical data should be surfaced without destroying historical data (the ability to reproduce analyses must be preserved). One possibility is to use validity flags and start/end dates to handle future changes to person details/demographics, either to correct for mistakes, or because demographic information has changed.

#### Person disambiguation
Prior to generating any new person_ids, there needs to be a process of disambiguation by checking against MRNs that are known to represent the same patient.

### VERSION TRACKING

_JZ 24-06-28_: initial version, loaded original omop table and possible modifications