
## CONDITION_OCCURRENCE

### OMOP CDM 5.4 - OMOP.CONDITION_OCCURRENCE
This table contains records of Events of a Person suggesting the presence of a disease or medical condition stated as a diagnosis, a sign, or a symptom, which is either observed by a Provider or reported by the patient.
```{mermaid}
erDiagram
    CONDITION_OCCURRENCE {
        condition_occurrence_id integer "[PK not null] autogenerated identifier"
        person_id integer "[FK not null]"
        condition_concept_id integer "[not null] standard OMOP concept id used for analyses"
        condition_start_date date "[not null]"
        condition_start_datetime timestamp
        condition_end_date date
        condition_end_datetime timestamp
        condition_type_concept_id integer "[not null] provenance of condition record per OMOP - see notes"
        condition_status_concept_id integer "how diagnosis was made - e.g. admission vs final"
        stop_reason varchar20 "why condition is no longer valid"
        provider_id integer "[FK] clinician provider who recorded condition"
        visit_occurrence_id integer "[FK]"
        visit_detail_id integer "[FK]"
        condition_source_value varchar50 "condition code as represented in source"
        condition_source_concept_id integer "mapping to omop but often left empty"
        condition_status_source_value varchar50 "condition status as represented in source"
    }
```

### IMPLEMENTATION - SILVER.CONDITION_OCCURRENCE

SILVER.CONDITION_OCCURRENCE is the cleaned and transformed version of ingested condition tables, that are used to stage vanilla OMOP CDM 5.4 tables (as well as other GOLD transformations). This table is wider than the OMOP data model, and includes the following differences:

- Includes an additional qualifier column to allow integration of 'diagnosis order' within NHS commissioning datasets;
- Standardised concept codes/names are surfaced, and indexed, to enable user-friendly exploration and visualisation without the need for large joins;
- Source concept codes/names are surfaced to enable direct visibility over semantic provenance;
- Each row holds information about a single concept relative to a single person. We can therefore incorporate additional, NHS-specific, information about table and systems provenance relative to source data. By extension, this allows for additional understanding of context of data generation, whereas it is often necessary to infer 'OMOP condition status' with no visibility over this process.  
- OMOP CDM 5.4 columns that are not relevant to the NHS, or to intended purposes, are initialised, but set as null, and remain empty when carried into OMOP.CONDITION_OCCURRENCE.

```{mermaid}
erDiagram
    SILVER_CONDITION_OCCURRENCE {
        condition_occurrence_id integer "[PK not null] autogenerated identifier"
        person_id integer "[FK not null]"
        condition_concept_id integer "[FK not null]"
        condition_concept_code varchar50 "[NEW] standard OMOP concept code"
        condition_concept_name varchar255 "[NEW] standard OMOP concept name"
        condition_concept_vocabulary_id varchar20 "[FK NEW] OMOP vocabulary id representing the standard concept"
        condition_diagnosis_order integer "[NEW] for commissioning data only, the diagnosis order given in source"
        condition_start_date date "[not null]"
        condition_start_datetime timestamp "[set as null]"
        condition_end_date date
        condition_end_datetime timestamp "[set as null]"
        condition_type_concept_id integer "[FK not null] categorisation through NHS systems - see notes"
        condition_status_concept_id integer "[set as null]"
        stop_reason varchar20 "[set as null]"
        provider_id integer "[set as null]"
        visit_occurrence_id integer "[FK]"
        visit_detail_id integer "[set as null]"      
        condition_source_value varchar50 "condition code as represented in source"
        condition_source_value_name varchar255 "condition name as represented in source"
        condition_source_concept_id integer "[set as null]"          
        condition_source_vocabulary_id varchar20 "[FK NEW] OMOP vocabulary id representing the source concept"
        condition_status_source_value varchar50 "[set as null]"
        source_system_provenance varchar50 "[NEW] name of specific system from which source table was ingested"
        source_table_provenance varchar50 "[NEW] source table name"
        source_row_id varchar50 "[NEW] unique row id for the single concept that is generated at ingestion"
    }

    OMOP_CONDITION_OCCURRENCE {
        condition_occurrence_id integer "[PK not null] autogenerated identifier"
        person_id integer "[FK not null]"
        condition_concept_id integer "[FK not null] standard OMOP concept id used for analyses"
        condition_start_date date "[not null]"
        condition_start_datetime timestamp "[set as null]"
        condition_end_date date
        condition_end_datetime timestamp "[set as null]"
        condition_type_concept_id integer "[FK not null] mapped from NHS systems - see notes "
        condition_status_concept_id integer "[set as null] option to infer from other fields"
        stop_reason varchar20 "[set as null]"
        provider_id integer "[set as null]"
        visit_occurrence_id integer "[FK]"
        visit_detail_id integer "[set as null]"
        condition_source_value varchar50 "condition code as represented in source"
        condition_source_concept_id integer "[set as null]"
        condition_status_source_value varchar50 "[set as null]"
    }
```


### ADDITIONAL NOTES

#### ROW, TABLE, AND SYSTEMS PROVENANCE

OMOP provides different ways for representing provenance. These include using concepts that represent the [type of data source](https://athena.ohdsi.org/search-terms/terms?domain=Type+Concept&standardConcept=Standard&page=1&pageSize=15&query=), and concepts that represent the [concept status](https://athena.ohdsi.org/search-terms/terms?domain=Condition+Status&standardConcept=Standard&page=1&pageSize=15&query=). "Type" is USA-centric and does not carry granularity to represent the specific types of NHS system (though NHS systems can be mapped to these categories). Concept status is specific to the context in which each condition code was recorded. In practice, this type of metadata is rarely present in NHS source data, and would usually be inferred by the source system. The SILVER table therefore includes additional columns to enable visibility over the source table, and NHS source system.

In addition, as each row primarily carries information about a single concept for a single person, it is possible to track this main relationship through to a source row via a row_id that is generated at data ingestion. This enables direct visbility over transformations during the pipeline.   

### OUTSTANDING ISSUES

None for now!

### VERSION TRACKING

_JZ 2024-June-29_: initial version, loaded original omop table and suggested SILVER model.